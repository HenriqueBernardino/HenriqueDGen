---
title: "Home"
site: workflowr::wflow_site
output:
  workflowr::wflow_html:
    toc: false
editor_options:
  chunk_output_type: console
---

## Introduction

### Phenotypic data
Descriptive and deviance analysis were performed to verify the distribution and the genotypic effects for resistance to foliar diseases.
In this work we used a natural logarithm transformation for Affected area by Anthracnosis at the innoculated area at stem in cassava plants (AnAr).

```{r}
suppressMessages(library(tidyverse))
library(here)
suppressMessages(library(reactable))

# Data read by R using here package to allow the read in any computer with different directory path
PhenoData <- readRDS(here::here("data", "DadosFenotipicos.RDS"))
# Add the control information for the Mixed Models analysis
control <- names(table(PhenoData$accession_name)[table(PhenoData$accession_name) > 30])
PhenoData$control <- ifelse(PhenoData$accession_name %in% control, PhenoData$accession_name, "999") 
PhenoData$new <- ifelse(PhenoData$accession_name %in% control, 0, 1)

# Change the Disease names to english abbreviations
colnames(PhenoData)[7:11] <- c("Anth", "WhLS", "BrLS", "BlLS", "AnAr")

# Natural logarithm transformation for Anthracnosis Area
PhenoData$AnAr <- log(PhenoData$AnAr)
```

#### Table 1. Phenotypic data for resistance to foliar disease evaluated at the Cassava Germplasm Bank of EMBRAPA, data collected in 2021.
```{r, echo = FALSE}
PhenoData %>% reactable(defaultPageSize = 10)
```
Anthracnosis (Anth), White Leaf spot (WhLS), Brown Leaf spot (BrLS), Blight Leaf Spot (BlLS), Affected area by Anthracnosis at the innoculated area at stem in cassava plants (AnAr).

```{r, message = FALSE, warning = FALSE, eval = TRUE}
lnfUtl <- colnames(PhenoData)[c(1:4, 12:13)]
PhenoData$talhao_number <- NULL
PhenoData$Idade <- NULL
traits <- colnames(PhenoData)[!colnames(PhenoData) %in% lnfUtl]
PhenoData2 <- PhenoData %>% gather(key = traits, value = Y, -all_of(lnfUtl))
```

#### Table 2. Data entry for the descriptive analysis and mixed models for resistance of foliar disease in cassava.
```{r, echo = FALSE}
PhenoData2 %>% reactable(defaultPageSize = 10)
```
Anthracnosis (Anth), White Leaf spot (WhLS), Brown Leaf spot (BrLS), Blight Leaf Spot (BlLS), Affected area by Anthracnosis at the innoculated area at stem in cassava plants (AnAr).

```{r}
saveRDS(PhenoData2, here::here("output", "DadosFenotipicosv2.RDS"))
```

## Atividades a finalizar nesta seção

- [ ] Ajustar nomes das características produtivas logo após ler o arquivo de dados no R

| Característica | Sigla |
| :------------: | :---: |
| **Genotipos** - 1˚coluna | Genotipos.BGM |
| Altura.de.planta....CO_334.0000018 | AP |
| Altura.de.planta.sem.folha....CO_334.0000125 | APsF |
| **PTR** - Produtividade Total de Raizes | PTR |
| **PRC** - Produtividade de Raiz Comercial | PRC |
| **PRNC** - Produtividade de Raizes ñ comerciais | PRNC |
| Peso.da.parte.aerea....CO_334.0000016 | PPA |
| Vigor.Inicial | Vigor |
| Vigor.da.planta.45.DAP..1-5. | Vigor45D |
| Vigor.da.planta.6.MAP..1-5. | Vigor6M |
| Vigor.da.planta.12.MAP..1-5. | Vigor12M |
|     |     |

  - Sugestão: usar a função colnames do R para trocar os nomes das características do Objeto que precisa trocar
  
```
colnames(DadosPhen)[c(18, 12, 13, 20)] <- c("PortePl","AltPl", "AltPlsF",
                                            "Vigor", "PPA")
```

- [ ] separar a característica Vigor em outro objeto do R, sem perder as informações de:

  - Ano
  - Campo
  - Local
  - Genotipos.BGM.
  - Genotipos
  - Bloco
  - Linha
  - Coluna


- [ ] Transformar as várias colunas do objeto com as informações de Vigor em uma única coluna, e adicionar uma coluna com o número da amostra de avaliação de Vigor.

  - Usar a função melt do pacote data.table do R

```
RawPhenoData %>% mutate("FlowerPresence" = flower.visual.rating.0.1.CO_334.0000111,
                        "FlowerVisRate" = flowering.ability.visual.assessment.0.3.CO_334.0000233,
                     .keep = "unused") %>% melt(data = .,
                                                id.vars = c("studyYear", "locationName", "germplasmName",
                                                            "replicate", "blockNumber", "plotNumber",
                                                            "plantNumber"),
                                                variable.name = "Trait",
                                                value.name = "Value") -> PhenoData
```
  - Argumentos da Função melt:
   - data: dados, se estiver utilizando o pipe (%>%) use o ponto (.), se não informe o objeto a ser transformado.
   - id.vars: indica a função melt quais são colunas que devem permanecer intactas no novo objeto.
   - variable.name: é o nome da nova coluna que indicará a origem da observação da nova coluna de característica.
   - value.name: Nome da coluna que juntará todas as informações.

```{r}
# Rodar o script aqui dentro
```
- [Descriptive Analysis](AnalisesDescritivas.html)

### [Mixed Models Analysis](AnalisesModelosMistos.html)

### [Discriminant Analysis of Principal Components](PCA_DAPC.html)

### [Dendrogram and Shannon-Weaver Index](Den_IndSH.html)
